<html layout:decorate="~{layout}">
<head>
  <link rel="stylesheet" th:href="@{/css/pages/sub.css}">
</head>
<div layout:fragment="content">

  <!-- 경로 -->
  <div class="navArea">
    <a th:href="@{/}">Home</a>
    <span>|</span>
    <a th:href="@{/review/sub}" >Content</a>
    <span>|</span>
    <span>DRAMA</span>
  </div>

    <!-- 타이틀 이미지 -->
    <section class="container-fluid text-center banner"></section>

  <form th:action="@{/review/sub/search}" method="get" class="search-form">
    <div class="input-group">
      <!-- 드롭다운 메뉴 -->
      <div class="input-group-prepend">
        <select name="filter" class="form-control" id="filterSelect">
          <option value="all">전체</option>
          <option value="tag">태그</option>
          <option value="title">제목</option>
          <option value="author">작성자</option>
        </select>
      </div>
      <!-- 검색어 입력 -->
      <input type="text" name="query" class="form-control" placeholder="Search in site">
      <!-- 검색 버튼 -->
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="submit" th:text="검색">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </form>

    <!-- 주요 내용 -->
    <div class="sub-contentArea">
      <section class="subArea">
        <div class="container mt-5">
          <!-- 탭 목록 -->
          <div class="tabBox">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="all-tab" onclick="showTabContent('all')" type="button">전체</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link " id="romance-tab" onclick="showTabContent('romance')" type="button">로맨스</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="action-tab" onclick="showTabContent('action')" type="button">액션</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="sf-tab" onclick="showTabContent('sf')" type="button">SF</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="horror-tab" onclick="showTabContent('horror')" type="button">Horror</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="comedy-tab" onclick="showTabContent('comedy')" type="button">Comedy</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="others-tab" onclick="showTabContent('others')" type="button">기타</button>
              </li>
            </ul>



            <p>전체 <strong>251</strong>(1/210)</p>

          </div>

          <!-- 탭 내용 -->
          <div class="tab-content" id="myTabContent">
            <div id="all-content" class="sub-tab_contentBox">
              <!-- 전체 탭 내용 -->
              <div class="sub-contentList_itemBox" th:each="review : ${reviews}" th:data-id="${review.id}" th:data-subcategory="${review.category.subCategory}" style="cursor: pointer;">
                <img th:src="@{/img/png/ex-img.png}" alt="img" data-id="${review.id}">
                <div class="sub-contentList_textBox" data-id="${review.id}">
                  <img th:src="@{/img/svg/token-branded_lovely.svg}" alt="svg" data-id="${review.id}">
                  <div class="sub-contentList_text" data-id="${review.id}">
                    <p th:text="${review.user}">없는유저</p>
                    <p th:text="${review.title}" data-id="${review.id}" class="sub-TitleText">Title</p>
                    <p class="sub-contentText" th:text="${review.contentStory}" data-id="${review.id}"></p>
                    <div class="sub-content_hashtagBox" data-id="${review.id}">
                      <div class="hashtagItem"><span>#hashtag</span></div>
                    </div>
                  </div>
                </div>
                <div class="sub-contentList_timeBox" data-id="${review.id}">
                  <span th:text="${#temporals.format(review.createDate, 'yyyy.MM.dd')}"></span>
                </div>
              </div>


            </div>

            <!-- 각 탭 내용에 대한 ID 추가 -->
            <div id="romance-content" class="sub-tab_contentBox" style="display: none;">
              <p>로맨스 탭 내용입니다.</p>
            </div>
            <div id="action-content" class="sub-tab_contentBox" style="display: none;">
              <!-- 액션 탭 내용 -->
              <p>액션 탭 내용입니다.</p>
            </div>
            <div id="sf-content" class="sub-tab_contentBox" style="display: none;">
              <!-- SF 탭 내용 -->
              <p>SF 탭 내용입니다.</p>
            </div>
            <div id="horror-content" class="sub-tab_contentBox" style="display: none;">
              <!-- Horror 탭 내용 -->
              <p>Horror 탭 내용입니다.</p>
            </div>
            <div id="comedy-content" class="sub-tab_contentBox" style="display: none;">
              <!-- Comedy 탭 내용 -->
              <p>Comedy 탭 내용입니다.</p>
            </div>
            <div id="others-content" class="sub-tab_contentBox" style="display: none;">
              <!-- 기타 탭 내용 -->
              <p>기타 탭 내용입니다.</p>
            </div>
          </div>



          <div class="sub-createBTN">
            <a class="a-btn btn btn-primary " th:href="@{/review/create}">글 등록</a>
          </div>
        </div>

      </section>
    </div>

    <div class="page-bar">
      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
          <li class="page-item disabled">
            <a class="page-link" href="#" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          <li class="page-item"><a class="page-link" href="#">1</a></li>
          <li class="page-item"><a class="page-link" href="#">2</a></li>
          <li class="page-item"><a class="page-link" href="#">3</a></li>
          <li class="page-item"><a class="page-link" href="#">4</a></li>
          <li class="page-item"><a class="page-link" href="#">5</a></li>
          <li class="page-item"><a class="page-link" href="#">6</a></li>
          <li class="page-item"><a class="page-link" href="#">7</a></li>
          <li class="page-item"><a class="page-link" href="#">8</a></li>
          <li class="page-item"><a class="page-link" href="#">9</a></li>
          <li class="page-item"><a class="page-link" href="#">10</a></li>
          <li class="page-item">
            <a class="page-link" href="#" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
</div>

</html>

<script>
  function showTabContent(subCategory) {
    console.log('showTabContent 함수 호출됨, 선택한 카테고리:', subCategory);

    // 모든 탭 콘텐츠를 숨김
    document.querySelectorAll('.sub-tab_contentBox').forEach(function(contentBox) {
        contentBox.style.display = 'none';
    });

    // 모든 리뷰 데이터를 담고 있는 콘텐츠 박스를 보여줌
    var allContentBox = document.getElementById('all-content');
    if (allContentBox) {
        allContentBox.style.display = 'block';
    } else {
        console.error("전체 콘텐츠 박스를 찾을 수 없습니다: all-content");
    }

    // 리뷰 아이템 필터링
    document.querySelectorAll('.sub-contentList_itemBox').forEach(function(item) {
        if (item.getAttribute('data-subcategory') === subCategory || subCategory === 'all') {
            item.style.display = 'flex';
            console.log('매칭 성공: ', item);
        } else {
            item.style.display = 'none';
            console.log('매칭 실패: ', item);
        }
    });

    // 모든 탭의 'active' 클래스 제거
    document.querySelectorAll('.nav-link').forEach(function(tab) {
        tab.classList.remove('active');
    });

    // 현재 클릭된 탭에 'active' 클래스 추가
    var selectedTab = document.getElementById(subCategory + '-tab');
    if (selectedTab) {
        selectedTab.classList.add('active');
        console.log('선택된 탭에 active 클래스 추가:', selectedTab);
    } else {
        console.error("탭을 찾을 수 없습니다: " + subCategory + '-tab');
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
      // 첫 페이지 로드 시 "전체" 탭 클릭 시뮬레이션
      showTabContent('all');

      // 각 리뷰 아이템에 대한 클릭 이벤트 추가
      document.querySelectorAll('.sub-contentList_itemBox').forEach(function(item) {
          item.addEventListener('click', function() {
              const reviewId = item.getAttribute('data-id');
              if (reviewId) {
                  window.location.href = `/review/detail/${reviewId}`;
              } else {
                  console.error("리뷰 ID를 찾을 수 없습니다.");
              }
          });
      });
  });

</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.sub-contentList_itemBox').forEach(function(item) {
      item.addEventListener('click', function() {
        const reviewId = item.getAttribute('data-id');
        if (reviewId) {
          window.location.href = `/review/detail/${reviewId}`;
        } else {
          console.error("리뷰 ID를 찾을 수 없습니다.");
        }
      });
    });
  });

</script>
